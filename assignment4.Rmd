---
title: "Effects of MPA designation and fishing pressure on the California spiny lobster (_Panulirus interruptus_)"
author: "Joanna Tang, Michelle Lee, & Rachel Behm"
date: "19 November 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# INTRODUCTION

The California spiny lobster (_Panulirus interruptus_) is one of the most commercially and economically important lobsters in their native range off the American West Coast (citation). The California Department of Fish and Wildlife (CDFW) estimate that nearly 600,000 individual spiny lobsters were harvested (both recreational and commercial) in the first half of the 2008-2009 season (citation). This number is, on average, half the total harvest from Mexico (citation). Given their economic importance, there are heavy restrictions on the fish season by both the CDFW and the Mexican government, with set harvest season dates, catch limits, and size restrictions (greater than 82.5-82.6 mm) (citation). Moreover, in 2012, Marine Protected Area (MPA) sites were established off the coast of California--excluding fishing activity for the protection of natural and cultural resources. These restrictions insure the sustainability of the fishery and the health of the kelp forest ecosystem in which they live and provide a unique opportunity to understand the direct impacts on spiny lobster populations.
  
While the California spiny lobster remains an important fishery, the species also plays an integral part in the marine communities of the giant kelp forest. _P. interruptus_ is not only an important food source for many predatory species such as the California sheephead, giant sea bass, cabezone, and several species of shark, but it is also a vital predator of sea urchins, clams, muscles, and worms. Given their important role in maintaining ecosystem balance in the kelp forests off the Pacific coast, understanding the human impacts on this species will allow us to better predict the health of these kelp forest ecosystems.
  
MPAs, like those off the coast of California, have been established across the United States marine areas in order to protect ecosystems, preserve cultural resources, and sustain fishery populations (citation). Studies have shown that the implementation of these protected areas have consistently increased the biomass of fished species both inside and outside of MPAs, indicating that these sites, overall, have improved the robustness and health of marine organisms (citation). For many fished species, like the spiny lobster, these biomass increases have important implications for the health and reproductive success as species typically reach sexual maturity with at a certain size. Thus, understanding the direct impacts of MPAs on spiny lobster abundance and size in relation to fishing pressure will allow us to foreshadow the future of the species and the ecosystems where they live. 

Here we will compare California spiny lobster catch and size in the Santa Barbara Channel from 2012 to 2017 to better understand how MPAs affect the species and the giant kelp ecosystem. These data were collected by the Santa Barbara Coast Long Term Ecological Research Program (SBC LTER) as an ongoing effort to monitor the impacts of management on marine habitats.

# METHODS

## _Data Collection_

Lobster size, abundance, and fishing pressure of _P. interruptus_ were collected from 2012-2017 at five SBC LTER Sites off the mainland coast of the Santa Barbara Channel: Arroyo Quemado (AQUE), Naples Reef (NAPL), Mohawk Reef (MOHK), Isla Vista (IVEE), and Carpinteria (CARP). Two of the sites (NAPL and IVEE) are located in or near CDFW MPAs, while the other three (AQUE, MOHK, and CARP) are not. Abundance and size data were collected annually by divers in the late summer before the start of the fishing season. Fishing pressure was determined by counting the number of commerical trap floats. Data were collected every two to four weeks during the lobster fishing season (October to March) (data citation). 

## _Statistical Analyses_

All statistical analyses and figures were created in R (version 3.4.2).

_Lobster size across sites_



_The affect of MPA status_

_Proportion of "legal" lobsters across sites_
To compare the propotion of legal lobster catch sizes across sites, we used a chi-square test 

```{r include = FALSE}
# Outline

# 0. Load packages and read in data
# 1. Create area graph of lobster abundance overlaid with line graph of fishing pressre (5 graphs, 1 per site)
# 2. Boxplots of lobster sizes (1 graph of 5 side-by-sides, 1 per site); ANOVA of lobster sizes (2017)
# 3. Boxplots of lobster sizes (5 graphs of side-by-side 2012-2017, 1 for each site); 2-sample t-tests comparing size 2012 vs 2017; ANOVA of lobster sizes (2012)
# 4. Chi-squared + ANOVA of carapace size (chi-squared for each site, then ANOVA of chi-squared values)

```

```{r include = FALSE}
# 0. Load packages and read in data

library(tidyverse)
library(knitr)
library(kableExtra)
library(effsize)
library(vcdExtra)

lobster_size_abundance <- read_csv("lobster_size_abundance.csv")
lobster_traps <- read_csv("Lobster_Trap_Counts_All_Years_20171219.csv")


```

```{r echo = FALSE, message = FALSE}

# 1. Lobster abundance and fishing pressure (5 bar + line graphs)

# Data of abundance by site and year
abundance_by_site <- lobster_size_abundance %>% 
  select(YEAR, SITE, COUNT) %>% 
  group_by(SITE, YEAR) %>% 
  summarize(
    abundance = sum(COUNT)
  )

# Data of fishing pressure by site and year
fishing_pressure <- lobster_traps %>% 
  select(YEAR, MONTH, DATE, SITE, TRAPS) %>% 
  filter(SITE == "AQUE" | SITE == "NAPL" | SITE == "MOHK" | SITE == "IVEE" | SITE == "CARP") %>% 
  filter(TRAPS != "-99999") %>% 
  group_by(SITE, YEAR) %>% 
  summarize(
    total_traps_by_month = sum(TRAPS)
    )

abundance_fishing_pressure <- ggplot(abundance_by_site, aes(x = YEAR, y = abundance)) +
  geom_area(aes(fill = SITE), show.legend = FALSE) +
  geom_line(data = fishing_pressure, aes(x = YEAR, y = total_traps_by_month/2)) +
  facet_wrap(~ SITE) +
  theme_classic() +
  scale_y_continuous(expand = c(0,0), sec.axis = sec_axis(~.*2, name = "Number of Traps")) +
  scale_x_continuous(expand = c(0,0)) +
  labs(x= "Year", title="Lobster abundance and fishing pressure (2012 - 2017)", y= "Spiny Lobster Abundance")

abundance_fishing_pressure



```

```{r echo = FALSE, message = FALSE}
# 2. Compare mean lobster size by site in 2017: Boxplots

# Data frame of lobster size and count in 2017
size_count <- as.data.frame(lobster_size_abundance) %>% 
  filter(YEAR == "2017", SIZE != "-99999") %>% 
  select(SITE, SIZE, COUNT)

size_freq <- expand.dft(size_count, freq = "COUNT") # Transformed data into tidy format so every observation is a row

# Side-by-side boxplots of lobster size
lobster_size <- ggplot(size_freq, aes(x = SITE, y = SIZE)) +
  geom_boxplot(aes(fill = SITE), show.legend = FALSE) +
  labs(x = "Site", y = "Lobster Carapace Length (mm)", title= "Mean lobster size by site in 2017") +
  theme_classic()

lobster_size

```

```{r include = FALSE}
# 2. Compare mean lobster size by site in 2017: ANOVA

# ANOVA of lobster size (2017)

size_hists <- ggplot(size_freq, aes(x = SIZE)) +
  geom_histogram() +
  facet_wrap(~ SITE, scale = "free")
size_hists
# Exploratory histograms -- looks normal

size_qq <- ggplot(size_freq, aes(sample = SIZE)) +
  geom_qq() +
  facet_wrap(~ SITE)
size_qq
# Exploratory qq-plots -- looks normal



# H0: All means of lobster sizes are equal across sites
# HA: At least 2 means differ

size_2017_anova <- aov(SIZE ~ SITE, data = size_freq)
summary(size_2017_anova)
# F = .0085 --> at least 2 means differ

# Post-hoc Tukey's HSD
TukeyHSD(size_2017_anova)
# NAPL-CARP p=.023, NAPL-IVEE p-.0037, NAPL-MOHK p=.058
```


```{r echo = FALSE, message = FALSE}

# 3. Changes in lobster size at MPA and non-MPA sites (comparing 2012 vs. 2017): Boxplots

# Data of just 2012 and 2017
#lobster_size_abundance$YEAR = as.character(lobster_size_abundance)

size_changes_count <- as.data.frame(lobster_size_abundance) %>% 
  filter(YEAR == "2012" | YEAR == "2017", SIZE != "-99999") %>% 
  select(YEAR, SITE, SIZE, COUNT, SBC_LTER_TRANSECT)
size_changes_freq <- expand.dft(size_changes_count, freq = "COUNT") # Transformed data into tidy format so every observation is a row

# Boxplots for each site
ivee <- ggplot(filter(size_changes_freq, SITE == "IVEE"), aes(x = YEAR, y = SIZE)) +
  geom_boxplot(aes(group = YEAR, fill = YEAR), show.legend = FALSE) +
  labs(x = "Year", y = "Lobster Carapace Length (mm)", title = "Changes in lobster size at Isla Vista from 2012 vs. 2017") +
  theme_classic()
ivee

iveecol <- ggplot(filter(size_changes_freq, SITE == "IVEE", YEAR == "2012" | YEAR == "2017"), aes(x= YEAR,  y= SIZE)) +
  geom_col(aes(group = YEAR, fill = YEAR), show.legend = FALSE) +
  labs(x = "Year", y = "Lobster Carapace Length (mm)", title = "Changes in lobster size at Isla Vista from 2012 vs. 2017") +
  theme_classic()
iveecol
################################################################################################################################
napl <- ggplot(filter(size_changes_freq, SITE == "NAPL"), aes(x = YEAR, y = SIZE)) +
  geom_boxplot(aes(group = YEAR, fill = YEAR), show.legend = FALSE) +
  labs(x = "Year", y = "Lobster Carapace Length (mm)", title = "Changes in lobster size at Naples from 2012 vs. 2017") +
  theme_classic()
napl

naplcol <- ggplot(filter(size_changes_freq, SITE == "NAPL", YEAR == "2012" | YEAR == "2017"), aes(x= YEAR,  y= SIZE)) +
  geom_col(aes(group = YEAR, fill = YEAR), show.legend = FALSE) +
  labs(x = "Year", y = "Lobster Carapace Length (mm)", title = "Changes in lobster size at Naples from 2012 vs. 2017") +
  theme_classic()
naplcol
###############################################################################################################################
aque <- ggplot(filter(size_changes_freq, SITE == "AQUE"), aes(x = YEAR, y = SIZE)) +
  geom_boxplot(aes(group = YEAR, fill = YEAR), show.legend = FALSE) +
  labs(x = "Year", y = "Lobster Carapace Length (mm)", title = "Changes in lobster size at Arroyo Quemado from 2012 vs. 2017") +
  theme_classic()
aque

aquecol <- ggplot(filter(size_changes_freq, SITE == "AQUE", YEAR == "2012" | YEAR == "2017"), aes(x= YEAR,  y= SIZE)) +
  geom_col(aes(group = YEAR, fill = YEAR), show.legend = FALSE) +
  labs(x = "Year", y = "Lobster Carapace Length (mm)", title = "Changes in lobster size at Arroyo Quemado from 2012 vs. 2017") +
  theme_classic()
aquecol
#################################################################################################################################
mohk <- ggplot(filter(size_changes_freq, SITE == "MOHK"), aes(x = YEAR, y = SIZE)) +
  geom_boxplot(aes(group = YEAR, fill = YEAR), show.legend = FALSE) +
  labs(x = "Year", y = "Lobster Carapace Length (mm)",title = "Changes in lobster size at Mohawk from 2012 vs. 2017") +
  theme_classic()
mohk

mohkcol <- ggplot(filter(size_changes_freq, SITE == "MOHK", YEAR == "2012" | YEAR == "2017"), aes(x= YEAR,  y= SIZE)) +
  geom_col(aes(group = YEAR, fill = YEAR), show.legend = FALSE) +
  labs(x = "Year", y = "Lobster Carapace Length (mm)", title = "Changes in lobster size at Mohawk from 2012 vs. 2017") +
  theme_classic()
mohkcol
##################################################################################################################################
carp <- ggplot(filter(size_changes_freq, SITE == "CARP"), aes(x = YEAR, y = SIZE)) +
  geom_boxplot(aes(group = YEAR, fill = YEAR), show.legend = FALSE) +
  labs(x = "Year", y = "Lobster Carapace Length (mm)",title = "Changes in lobster size at Carpinteria from 2012 vs. 2017") +
  theme_classic()
carp

carpcol <- ggplot(filter(size_changes_freq, SITE == "CARP", YEAR == "2012" | YEAR == "2017"), aes(x= YEAR,  y= SIZE)) +
  geom_col(aes(group = YEAR, fill = YEAR), show.legend = FALSE) +
  labs(x = "Year", y = "Lobster Carapace Length (mm)", title = "Changes in lobster size at Carpinteriafrom 2012 vs. 2017") +
  theme_classic()
carpcol
#################################################################################################################################
allbox<-ggplot(size_changes_freq, aes(x = YEAR, y = SIZE)) +
  geom_boxplot(aes(group = YEAR, fill = YEAR), show.legend = FALSE) + facet_wrap(~SITE)
  labs(x = "Year", y = "Lobster Carapace Length (mm)",title = "Changes in lobster size at Carpinteria from 2012 vs. 2017") +
  theme_classic()
allbox 

allcol<-ggplot(size_changes_freq, aes(x = YEAR, y = SIZE)) +
  geom_col(aes(group = YEAR, fill = YEAR), show.legend = TRUE) + facet_wrap(~SITE)
  labs(x = "Year", y = "Lobster Carapace Length (mm)",title = "Changes in lobster size at Carpinteria from 2012 vs. 2017") +
  theme_classic()
allcol  
```

```{r include = FALSE}

# 3. Changes in lobster size at MPA and non-MPA sites (comparing 2012 vs. 2017): T-tests and ANOVA

# Two-sample (paired) t-tests of lobster size (2012 vs. 2017 for each site)

size_2012_hists <- ggplot(filter(size_changes_freq, YEAR == "2012"), aes(x = SIZE)) +
  geom_histogram() +
  facet_wrap(~ SITE, scale = "free")
size_2012_hists
# Exploratory histograms -- looks normal except for NAPL

size_2017_hists <- ggplot(filter(size_changes_freq, YEAR == "2017"), aes(x = SIZE)) +
  geom_histogram() +
  facet_wrap(~ SITE, scale = "free")
size_2017_hists
# Exploratory histograms -- looks normal

size_2012_qq <- ggplot(filter(size_changes_freq, YEAR == "2012"), aes(sample = SIZE)) +
  geom_qq() +
  facet_wrap(~ SITE)
size_2012_qq
# Exploratoery qq-plots -- looks normal

size_2017_qq <- ggplot(filter(size_changes_freq, YEAR == "2017"), aes(sample = SIZE)) +
  geom_qq() +
  facet_wrap(~ SITE)
size_2017_qq
# Exploratoery qq-plots -- looks normal



# H0: Mean lobster size in 2012 is the same as mean lobster size in 2017
# HA: Means differ

ivee_2012 <- filter(size_changes_freq, SITE == "IVEE", YEAR == "2012")
ivee_2017 <- filter(size_changes_freq, SITE == "IVEE", YEAR == "2017")
ivee_t <- t.test(ivee_2012$SIZE, ivee_2017$SIZE)
ivee_t # p = .0361, means equal

napl_2012 <- filter(size_changes_freq, SITE == "NAPL", YEAR == "2012")
napl_2017 <- filter(size_changes_freq, SITE == "NAPL", YEAR == "2017")
naple_t <- t.test(napl_2012$SIZE, napl_2017$SIZE)
naple_t # p = .54, means equal

aque_2012 <- filter(size_changes_freq, SITE == "AQUE", YEAR == "2012")
aque_2017 <- filter(size_changes_freq, SITE == "AQUE", YEAR == "2017")
aque_t <- t.test(aque_2012$SIZE, aque_2017$SIZE)
aque_t # p = .19, means equal

mohk_2012 <- filter(size_changes_freq, SITE == "MOHK", YEAR == "2012")
mohk_2017 <- filter(size_changes_freq, SITE == "MOHK", YEAR == "2017")
mohk_t <- t.test(mohk_2012$SIZE, mohk_2017$SIZE)
mohk_t # p = .00016, means different (mean decreased)

carp_2012 <- filter(size_changes_freq, SITE == "CARP", YEAR == "2012")
carp_2017 <- filter(size_changes_freq, SITE == "CARP", YEAR == "2017")
carp_t <- t.test(carp_2012$SIZE, carp_2017$SIZE)
carp_t # p = .2211, means equal


# ANOVA for 2012

# H0: All means of lobster sizes are equal across sites in 2017
# HA: At least 2 means differ

size_2012_anova <- aov(SIZE ~ SITE, data = filter(size_changes_freq, YEAR == "2012"))
summary(size_2012_anova)
# F = .000999 --> at least 2 means differ

# Post-hoc Tukey's HSD
TukeyHSD(size_2012_anova)
# IVEE-CARP p=.025, MOHK-IVEE p=.00062

```

```{r}
# 4. Proportions of "legal" lobsters at the 5 sites in 2017

```


# Conclusions

Given that spiny lobsters remain, and will remain, economically important for both California and Mexico, understanding the implications of managed and protected lobster habitats is vital for the future of the species and the fishery.

# References

Caselle, JE, Rassweiler, A, Hamilton, SL, and Warner, RR. 2015. Recovery trajectories of kelp forest animals are rapid yet spatially variable across a network of temperate marine protected areas. Scientific Reports: 14102. 

Reed, D. 2017. SBC LTER: Reef: Abundance, size and fishing effort for California Spiny Lobster (_Panulirus interruptus_), ongoing since 2012. Santa Barbara Coastal Long Term Ecological Research Project. doi:10.6073/pasta/81ce20b29614ec99d85d54907eaa3e8e.

